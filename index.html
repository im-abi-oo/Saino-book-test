<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Manga Ultra Pro | Apex Engine v11.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css" rel="stylesheet"/>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --accent: #d946ef;
            --accent-glow: rgba(217, 70, 239, 0.4);
            --bg-base: #040405;
            --panel-bg: rgba(10, 10, 14, 0.98);
            --manga-width: 900px;
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: var(--bg-base);
            color: #f4f4f5;
            margin: 0;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
        }

        /* Modern Scrollbars */
        .custom-scroll::-webkit-scrollbar { width: 5px; height: 5px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { 
            background: rgba(255, 255, 255, 0.1); 
            border-radius: 10px; 
        }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: var(--accent); }

        /* Core Structure */
        #reader-container {
            width: 100vw;
            height: 100vh;
            overflow-y: auto;
            overflow-x: hidden;
            scroll-behavior: smooth;
            background: #000;
        }

        #reader-core {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 auto;
            width: 100%;
            max-width: var(--manga-width);
            transition: max-width 0.4s ease;
        }

        .mode-horizontal #reader-container {
            display: flex;
            overflow-x: auto;
            overflow-y: hidden;
            scroll-snap-type: x mandatory;
            direction: ltr;
        }

        .mode-horizontal #reader-core {
            flex-direction: row-reverse;
            max-width: none !important;
            height: 100%;
        }

        .page-wrapper {
            width: 100%;
            position: relative;
            min-height: 50vh;
            display: flex;
            justify-content: center;
            border-bottom: 4px solid #000;
        }

        .mode-horizontal .page-wrapper {
            min-width: 100vw;
            height: 100vh;
            scroll-snap-align: start;
            border-bottom: none;
        }

        .manga-page {
            width: 100%;
            height: auto;
            object-fit: contain;
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none; /* Security: prevent right click directly on image */
        }

        .manga-page.loaded { opacity: 1; }

        /* UI Styling */
        .glass {
            background: var(--panel-bg);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .setting-card {
            @apply mb-4 p-5 rounded-[2rem] bg-white/[0.03] border border-white/[0.05] transition-all;
        }

        .setting-card.active {
            @apply bg-fuchsia-600/10 border-fuchsia-500/50 shadow-[0_0_20px_rgba(217,70,239,0.1)];
        }

        /* Modern Sliders */
        input[type="range"] {
            -webkit-appearance: none;
            @apply w-full h-1.5 bg-zinc-800 rounded-full outline-none mt-4;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            @apply w-6 h-6 bg-white rounded-full border-4 border-fuchsia-600 shadow-lg cursor-pointer transition-transform;
        }
        input[type="range"]:active::-webkit-slider-thumb { transform: scale(1.2); }

        /* Quality Buttons */
        .q-btn { @apply flex-1 py-3 rounded-2xl bg-zinc-900 border border-white/5 text-[10px] font-black transition-all text-zinc-500; }
        .q-btn.active { @apply bg-white text-black border-white shadow-xl scale-105; }

        /* Chapter List Styling */
        .ch-card {
            @apply h-16 rounded-2xl border border-white/5 bg-white/[0.03] flex items-center justify-center text-sm font-black transition-all;
        }
        .ch-card.active {
            @apply bg-fuchsia-600 border-fuchsia-400 text-white shadow-lg shadow-fuchsia-600/30 ring-4 ring-fuchsia-600/20;
            animation: pulse-active 2s infinite;
        }

        @keyframes pulse-active {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        .ui-hide-top { transform: translateY(-150%); opacity: 0; }
        .ui-hide-bottom { transform: translateY(150%); opacity: 0; }
    </style>
</head>
<body class="bg-black">

    <!-- Top Navigation -->
    <header id="top-nav" class="fixed top-5 inset-x-5 z-50 transition-all duration-500">
        <div class="max-w-5xl mx-auto glass rounded-[2.5rem] p-3.5 flex items-center justify-between shadow-2xl">
            <div class="flex items-center gap-4">
                <button onclick="toggleSidebar('chapters')" class="w-14 h-14 rounded-[1.5rem] bg-fuchsia-600 text-white flex items-center justify-center shadow-lg active:scale-90 transition-all">
                    <i data-lucide="book-text" class="w-7"></i>
                </button>
                <div>
                    <h1 class="text-sm font-black text-white">تک‌رو (Solo Leveling)</h1>
                    <div class="flex items-center gap-2 mt-1">
                        <span class="w-1.5 h-1.5 rounded-full bg-fuchsia-500"></span>
                        <p id="indicator" class="text-[10px] text-zinc-500 font-bold">چپتر ۱۷۹ • صفحه ۱</p>
                    </div>
                </div>
            </div>
            
            <button onclick="toggleSidebar('settings')" class="w-14 h-14 rounded-[1.5rem] bg-zinc-900 border border-white/5 flex items-center justify-center text-zinc-400">
                <i data-lucide="settings-2" class="w-7"></i>
            </button>
        </div>
    </header>

    <!-- Content -->
    <main id="reader-container" class="custom-scroll" onclick="toggleUI()">
        <div id="reader-core"></div>
    </main>

    <!-- Bottom Nav -->
    <nav id="bottom-nav" class="fixed bottom-8 inset-x-0 z-50 transition-all duration-500 pointer-events-none">
        <div class="max-w-xs mx-auto glass rounded-full p-2.5 flex items-center justify-between pointer-events-auto">
            <button onclick="navigate('prev')" class="w-14 h-14 rounded-full flex items-center justify-center text-zinc-500 hover:text-white transition-all">
                <i data-lucide="arrow-right-circle" class="w-8"></i>
            </button>
            <button onclick="scrollToTop()" class="w-14 h-14 rounded-full bg-white text-black flex items-center justify-center shadow-xl hover:scale-110 transition-all">
                <i data-lucide="arrow-up" class="w-6"></i>
            </button>
            <button onclick="navigate('next')" class="w-14 h-14 rounded-full flex items-center justify-center text-zinc-500 hover:text-white transition-all">
                <i data-lucide="arrow-left-circle" class="w-8"></i>
            </button>
        </div>
    </nav>

    <!-- Side: Chapters -->
    <aside id="side-chapters" class="fixed inset-y-0 right-0 w-full md:w-[450px] glass z-[100] translate-x-full transition-transform duration-500 flex flex-col hidden">
        <div class="p-8 border-b border-white/5 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <i data-lucide="list-video" class="text-fuchsia-500"></i>
                <h2 class="text-xl font-black">لیست فصول</h2>
            </div>
            <button onclick="closeSidebar('chapters')" class="w-12 h-12 rounded-2xl bg-white/5 flex items-center justify-center text-zinc-400 hover:text-red-500">
                <i data-lucide="x"></i>
            </button>
        </div>
        <div id="ch-list" class="flex-grow overflow-y-auto p-6 grid grid-cols-4 gap-3 custom-scroll"></div>
    </aside>

    <!-- Side: Settings -->
    <aside id="side-settings" class="fixed inset-y-0 right-0 w-full md:w-[450px] glass z-[100] translate-x-full transition-transform duration-500 flex flex-col hidden">
        <div class="p-8 border-b border-white/5 flex items-center justify-between">
            <h2 class="text-xl font-black">تنظیمات رندر</h2>
            <button onclick="closeSidebar('settings')" class="w-12 h-12 rounded-2xl bg-white/5 flex items-center justify-center text-zinc-400">
                <i data-lucide="x"></i>
            </button>
        </div>
        <div class="p-6 space-y-4 overflow-y-auto custom-scroll">
            
            <div class="setting-card" id="card-quality">
                <p class="text-[11px] font-black text-zinc-400 mb-4 flex items-center gap-2">
                    <i data-lucide="cpu" class="w-4"></i> ارتقای کیفیت هوشمند
                </p>
                <div class="flex gap-2">
                    <button onclick="setQuality(0)" class="q-btn" id="q0">Standard</button>
                    <button onclick="setQuality(1)" class="q-btn" id="q1">High Pro</button>
                    <button onclick="setQuality(2)" class="q-btn" id="q2">Ultra AI</button>
                </div>
            </div>

            <div class="setting-card" id="card-width">
                <div class="flex justify-between items-center text-[11px] font-black text-zinc-400">
                    <span class="flex items-center gap-2"><i data-lucide="maximize" class="w-4"></i> ابعاد محتوا</span>
                    <span id="val-width" class="text-fuchsia-500">900px</span>
                </div>
                <input type="range" min="400" max="1800" value="900" oninput="updateWidth(this.value)">
            </div>

            <div class="setting-card" id="card-auto">
                <div class="flex justify-between items-center mb-2 text-[11px] font-black text-zinc-400">
                    <span class="flex items-center gap-2"><i data-lucide="zap" class="w-4"></i> سرعت اسکرول</span>
                    <button onclick="toggleAuto()" id="btn-auto" class="px-3 py-1 bg-zinc-800 rounded-lg">خاموش</button>
                </div>
                <input type="range" min="1" max="100" value="10" oninput="updateSpeed(this.value)">
            </div>

            <div class="grid grid-cols-2 gap-3">
                <button onclick="setMode('vertical')" id="m-v" class="setting-card !mb-0 flex flex-col items-center gap-2">
                    <i data-lucide="mouse-pointer-2" class="w-5"></i>
                    <span class="text-[10px] font-black">عمودی</span>
                </button>
                <button onclick="setMode('horizontal')" id="m-h" class="setting-card !mb-0 flex flex-col items-center gap-2">
                    <i data-lucide="move-horizontal" class="w-5"></i>
                    <span class="text-[10px] font-black">افقی</span>
                </button>
            </div>
        </div>
    </aside>

    <div id="overlay" onclick="closeAllSidebars()" class="fixed inset-0 bg-black/80 backdrop-blur-md z-[90] hidden transition-opacity duration-500 opacity-0"></div>

    <script>
        let state = {
            mode: 'vertical',
            width: 900,
            quality: 0,
            speed: 10,
            isAuto: false,
            ui: true,
            currentChapter: 179
        };

        let autoScrollInterval = null;

        function init() {
            renderPages();
            renderChapters();
            applyState();
            setupSecurity();
            lucide.createIcons();
        }

        function renderPages() {
            const container = document.getElementById('reader-core');
            container.innerHTML = '';
            for(let i=1; i<=25; i++) {
                const wrap = document.createElement('div');
                wrap.className = 'page-wrapper';
                wrap.id = `page-${i}`;
                wrap.innerHTML = `<img class="manga-page" data-src="https://picsum.photos/seed/v11-${i}/1200/1800">`;
                container.appendChild(wrap);
            }
            setupObserver();
        }

        function renderChapters() {
            const list = document.getElementById('ch-list');
            list.innerHTML = '';
            for(let i=1; i<=185; i++) {
                const btn = document.createElement('button');
                btn.className = `ch-card ${i === state.currentChapter ? 'active' : ''}`;
                btn.innerText = i;
                list.appendChild(btn);
            }
        }

        function applyState() {
            setMode(state.mode);
            updateWidth(state.width);
            setQuality(state.quality);
            updateSpeed(state.speed);
        }

        // Action Functions
        function setMode(m) {
            state.mode = m;
            document.body.className = m === 'horizontal' ? 'mode-horizontal' : '';
            document.getElementById('m-v').classList.toggle('active', m === 'vertical');
            document.getElementById('m-h').classList.toggle('active', m === 'horizontal');
            setupObserver();
        }

        function updateWidth(w) {
            state.width = w;
            document.documentElement.style.setProperty('--manga-width', `${w}px`);
            document.getElementById('val-width').innerText = `${w}px`;
            document.getElementById('card-width').classList.toggle('active', w > 1000);
        }

        function setQuality(lv) {
            state.quality = lv;
            const filters = ['none', 'contrast(1.05) saturate(1.1) sharp', 'contrast(1.15) saturate(1.2) brightness(1.1)'];
            document.querySelectorAll('.q-btn').forEach((b, i) => b.classList.toggle('active', i === lv));
            document.querySelectorAll('.manga-page').forEach(img => {
                img.style.filter = filters[lv];
                img.style.imageRendering = lv > 0 ? 'crisp-edges' : 'auto';
            });
            document.getElementById('card-quality').classList.toggle('active', lv > 0);
        }

        function toggleAuto() {
            state.isAuto = !state.isAuto;
            const btn = document.getElementById('btn-auto');
            if(state.isAuto) {
                btn.innerText = 'در حال حرکت';
                btn.className = 'px-3 py-1 bg-fuchsia-600 text-white rounded-lg shadow-lg';
                document.getElementById('card-auto').classList.add('active');
                autoScrollInterval = setInterval(() => {
                    const c = document.getElementById('reader-container');
                    const step = state.speed / 10;
                    if(state.mode === 'vertical') c.scrollTop += step;
                    else c.scrollLeft -= step;
                }, 16);
            } else {
                btn.innerText = 'خاموش';
                btn.className = 'px-3 py-1 bg-zinc-800 rounded-lg';
                document.getElementById('card-auto').classList.remove('active');
                clearInterval(autoScrollInterval);
            }
        }

        function updateSpeed(s) { state.speed = s; }

        function toggleUI() {
            state.ui = !state.ui;
            document.getElementById('top-nav').classList.toggle('ui-hide-top', !state.ui);
            document.getElementById('bottom-nav').classList.toggle('ui-hide-bottom', !state.ui);
        }

        function navigate(dir) {
            const c = document.getElementById('reader-container');
            const step = state.mode === 'vertical' ? window.innerHeight * 0.8 : window.innerWidth;
            if(state.mode === 'vertical') c.scrollBy({top: dir === 'next' ? step : -step, behavior: 'smooth'});
            else c.scrollBy({left: dir === 'next' ? -step : step, behavior: 'smooth'});
        }

        function setupObserver() {
            const container = document.getElementById('reader-container');
            const options = { threshold: 0.1, root: state.mode === 'horizontal' ? container : null };
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(e => {
                    if(e.isIntersecting) {
                        const img = e.target.querySelector('img');
                        if(img && !img.src) {
                            img.src = img.dataset.src;
                            img.onload = () => img.classList.add('loaded');
                        }
                        document.getElementById('indicator').innerText = `چپتر ۱۷۹ • صفحه ${e.target.id.split('-')[1]}`;
                    }
                });
            }, options);
            document.querySelectorAll('.page-wrapper').forEach(p => observer.observe(p));
        }

        // Security Layer
        function setupSecurity() {
            document.addEventListener('contextmenu', e => e.preventDefault());
            document.addEventListener('keydown', e => {
                if(e.ctrlKey && (e.key === 's' || e.key === 'u' || e.key === 'p' || e.key === 'i')) e.preventDefault();
                if(e.key === 'F12') e.preventDefault();
            });
            document.addEventListener('dragstart', e => { if(e.target.tagName === 'IMG') e.preventDefault(); });
        }

        // UI Handlers
        function toggleSidebar(id) {
            const s = document.getElementById(`side-${id}`);
            const o = document.getElementById('overlay');
            s.classList.remove('hidden');
            o.classList.remove('hidden');
            setTimeout(() => { s.classList.remove('translate-x-full'); o.classList.add('opacity-100'); }, 10);
        }

        function closeSidebar(id) {
            const s = document.getElementById(`side-${id}`);
            const o = document.getElementById('overlay');
            s.classList.add('translate-x-full');
            o.classList.remove('opacity-100');
            setTimeout(() => { s.classList.add('hidden'); o.classList.add('hidden'); }, 500);
        }

        function closeAllSidebars() { closeSidebar('settings'); closeSidebar('chapters'); }
        function scrollToTop() { document.getElementById('reader-container').scrollTo({top: 0, behavior: 'smooth'}); }

        window.onload = init;
    </script>
</body>
</html>
